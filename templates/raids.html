{% extends "base.html" %}

{% block title %}PoGo Intel | Raid Protocol{% endblock %}
{% block meta_description %}Monitor current and upcoming Pok√©mon GO raid bosses with tiered tactical visibility.{% endblock %}

{% block content %}
<section class="hero reveal" style="background-image: url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=1600&q=80');">
    <div class="hero-content">
        <p class="eyebrow">[ RAID SURVEILLANCE ]</p>
        <h1 class="hero-line-a">Raid Network beyond</h1>
        <h2 class="hero-line-b">Limits.</h2>
        <p class="hero-copy">
            Inspect active raid rotations, tier distributions, and encounter pools with a high-signal tactical interface.
        </p>
        <a href="#raid-grid" class="btn-magnetic nav-cta">
            <span></span>
            <em>View Raid Intel</em>
        </a>
        {% if last_fetch %}
        <p class="last-fetch">Last fetch: {{ last_fetch }}</p>
        {% endif %}
    </div>
</section>

<section class="info-panel reveal">
    <p><strong>{{ events|length }}</strong> raid-tagged events currently indexed. Ongoing events are prioritized.</p>
</section>

{% if events %}
<section id="raid-grid" class="event-grid">
    {% for event in events %}
    <article class="event-card reveal">
        {% if event.hero_image %}
        <img src="{{ event.hero_image }}" alt="{{ event.title or event.name }}" class="event-image">
        {% endif %}

        <div class="event-content">
            {% if event.is_ongoing %}
            <div class="ongoing-badge">
                <span class="ongoing-dot"></span>
                <span>ONGOING</span>
            </div>
            {% endif %}

            {% if event.detail_types %}
            <div class="event-types">
                {% for type in event.detail_types %}
                <span class="event-type-badge {{ type|lower|replace(' ', '-') }}">{{ type }}</span>
                {% endfor %}
            </div>
            {% endif %}

            <h3 class="event-title">{{ event.title or event.name }}</h3>

            {% if event.start_date and event.start_time %}
            <div class="event-date">
                üìÖ {{ event.start_date }} {{ event.start_time }}
                {% if event.end_date and event.end_time %}
                <br>to {{ event.end_date }} {{ event.end_time }}
                {% endif %}
            </div>
            {% endif %}

            <div class="section-toggle">
                {% for tier, pokemon_list in event.raid_pokemon.items() %}
                <div class="raid-tier-section">
                    <div class="raid-tier-header {% if 'Shadow' in tier %}tier-shadow{% endif %}">
                        <span class="tier-icon">‚öîÔ∏è</span>
                        <span>{{ tier }}</span>
                    </div>
                    <div class="raid-pokemon-list">
                        {% for pokemon in pokemon_list %}
                        <div class="raid-pokemon">
                            {% if pokemon.image %}
                            <img src="{{ pokemon.image }}" alt="{{ pokemon.name }}">
                            {% endif %}
                            <span>{{ pokemon.name }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if event.additional_sections %}
            {% for section in event.additional_sections %}
            {% if section.category == "raid" %}
            <div class="section-toggle">
                <div class="raid-title" onclick="toggleSection(this)">{{ section.icon }} {{ section.display_title }}</div>
                <div class="raid-content">
                    {% if section.type == "grouped" %}
                        {% for group in section.groups %}
                        <div class="raid-tier-section">
                            {% if group.title %}
                            <div class="raid-tier-header">
                                <span class="tier-icon">‚öîÔ∏è</span>
                                <span>{{ group.title }}</span>
                            </div>
                            {% endif %}
                            <div class="raid-pokemon-list">
                                {% for pokemon in group.items %}
                                <div class="raid-pokemon">
                                    {% if pokemon.image %}
                                    <img src="{{ pokemon.image }}" alt="{{ pokemon.name }}">
                                    {% endif %}
                                    <span>{{ pokemon.name }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    {% elif section.type == "list" %}
                        <div class="raid-pokemon-list">
                            {% for pokemon in section["items"] %}
                            <div class="raid-pokemon">
                                {% if pokemon.image %}
                                <img src="{{ pokemon.image }}" alt="{{ pokemon.name }}">
                                {% endif %}
                                <span>{{ pokemon.name }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    {% elif section.type == "text" %}
                        <p class="section-text">{{ section.content }}</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endfor %}
            {% endif %}

            {% if event.url %}
            <a href="{{ event.url }}" target="_blank" rel="noopener noreferrer" class="event-link">View on Leek Duck ‚Üí</a>
            {% endif %}
        </div>
    </article>
    {% endfor %}
</section>
{% else %}
<div class="no-raids reveal">
    <p>No raid events currently available in the feed.</p>
</div>
{% endif %}
{% endblock %}